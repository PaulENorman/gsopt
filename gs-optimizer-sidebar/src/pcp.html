<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { margin: 0; padding: 10px; font-family: sans-serif; }
        #plot { width: 100%; height: 95vh; }
    </style>
</head>
<body>
    <div id="plot"></div>
    <script>
        window.onload = function() {
            google.script.run
                .withSuccessHandler(drawPlot)
                .withFailureHandler(err => document.body.innerHTML = "Error loading data: " + err)
                .getPcpData();
        };

        function drawPlot(data) {
            if (!data || data.rows.length === 0) {
                document.body.innerHTML = 'No data available in the "Data" sheet to visualize.';
                return;
            }

            const dimensions = data.headers.map((header, i) => {
                return {
                    label: header,
                    values: data.rows.map(row => row[i])
                };
            });

            const trace = {
                type: 'parcoords',
                line: {
                    showscale: true,
                    reversescale: true,
                    colorscale: 'Rainbow',
                    color: data.rows.map(row => row[data.headers.length - 1]) // Color by the objective column
                },
                dimensions: dimensions
            };

            const layout = {
                margin: { t: 50, b: 20, l: 50, r: 50 }
            };

            Plotly.newPlot('plot', [trace], layout, {responsive: true});
        }
    </script>
</body>
</html>
